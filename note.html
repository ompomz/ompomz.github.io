<!DOCTYPE html>
<html lang="ja">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>ompomznote</title>  
 <link rel="stylesheet" href="./note.css">
 <script src="https://ompomz.github.io/header/loadHeader.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<div id="header-placeholder"></div>
<div class="note-container" id="content"></div>
<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id"); // URLから記事ID（?id=xxx の xxx）を取得
const content = document.getElementById("content"); // 記事内容を表示する要素を取得
 
function goBackOrHome() {
    // document.referrer (一つ前のページのURL) があり、かつ現在のページと異なる場合に true
    if (document.referrer && document.referrer !== window.location.href) {
        // 外部サイトやリスト画面など、直前のページに戻る
        history.back();
    } else {
        // 履歴がない場合（直リンク、ブックマークなど）は、記事一覧の note.html へ強制的に遷移
        window.location.href = "./note.html"; 
    }
}
if (id) {
    // IDがある場合（個別記事の表示）
    fetch(`note/${id}.md`)
        .then(res => res.text())
        .then(md => {
            // カスタムレンダラーを作成 (marked.js用)
            const renderer = new marked.Renderer();
            renderer.br = () => '</p><p>'; // 改行コードの特殊処理

            // MarkdownをHTMLに変換（カスタムレンダラーを適用）
            const articleHtml = marked.parse(md, { renderer });

            // 「もどる」リンクを作成
            const backLink = '<p><a href="" onclick="goBackOrHome(); return false;">＜ もどる</a></p>';
            
            // 記事コンテンツ、罫線、「もどる」リンクの順に結合してHTMLに設定
            content.innerHTML = articleHtml + '<hr>' + backLink;
        })
        .catch(() => {
            // 記事ファイルが見つからない場合
            content.innerHTML = "<p>記事が見つかりません。</p>";
            const backLink = '<p><a href="" onclick="goBackOrHome(); return false;">＜ もどる</a></p>';
            
            content.innerHTML += backLink;
        });
} else {
    // IDが無い場合（記事一覧の表示）
    content.innerHTML = `
        <h2>ompomznote</h2>
        <ul>
          <li><a href="?id=251126">Memories of Nostrasia2025</a></li>
          <li><a href="?id=251201">test</a></li>
          <li><a href="?id=251204">Creating Client with AI</a></li>
        </ul>
    `;
}
</script>
</body>
</html>
